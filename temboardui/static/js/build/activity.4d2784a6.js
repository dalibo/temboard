(window.webpackJsonp=window.webpackJsonp||[]).push([["activity"],{"./temboardui/plugins/activity/static/js/temboard.activity.js":function(t,e,a){"use strict";a.r(e),function(t){var e=a("./node_modules/datatables.net-bs4/js/dataTables.bootstrap4.js"),n=a.n(e);a("./node_modules/datatables.net-bs4/css/dataTables.bootstrap4.css");n()(window,t),t(function(){var e,a=null,n=2,o=!1;t("#intervalDuration").html(n);var r=t("#tableActivity");function s(e,a){"Y"==a&&t(e).addClass("text-danger font-weight-bold")}var l="Select to terminate",d="Disable auto-refresh and select to terminate",c=[{orderable:!1,className:"text-center",data:function(t,e,a,n){var i=o?"disabled":"",r=i?d:l,s='<input type="checkbox" '+i+' class="input-xs" data-pid="'+t.pid+'"';return s+='title="'+r+'"',s+=" />"}},{title:"PID",data:"pid",className:"text-right",orderable:!1},{title:"Database",data:"database",orderable:!1},{title:"User",data:"user",orderable:!1},{title:"CPU",data:"cpu",className:"text-right"},{title:"mem",data:"memory",className:"text-right"},{title:"Read/s",data:function(t){return t.read_s.human2bytes()},render:function(t,e,a){return"display"==e?a.read_s:t},className:"text-right"},{title:"Write/s",data:function(t){return t.write_s.human2bytes()},render:function(t,e,a){return"display"==e?a.write_s:t},className:"text-right"},{title:"IOW",data:"iow",className:"text-center",createdCell:s}];c="running"==activityMode?c.concat([{title:"W",data:"wait",className:"text-center",createdCell:s}]):c.concat([{title:"Lock Rel.",data:"relation",className:"text-right",orderable:!1},{title:"Lock Mode",data:"mode",orderable:!1},{title:"Lock Type",data:"type",orderable:!1}]);c=c.concat([{title:"State",data:function(t,e,a,n){return t.state&&t.state.trunc(12)},className:"text-center",createdCell:function(e,a,n,o,i){var r="";switch(n.state){case"active":r="text-success font-weight-bold";break;case"idle in transaction":case"idle in transaction (aborted)":r="text-danger font-weight-bold"}t(e).addClass(r),n.state.length>12&&t(e).attr("title",n.state)}},{title:"Time",className:"text-right",data:"duration",render:function(t,e,a){return"display"===e?t+" s":t}},{title:"Query",className:"query",data:function(t,e,a,n){return'<pre><code class="sql">'+t.query+"</code></pre>"},createdCell:function(e,a){t(e).attr("data-toggle","popover").attr("data-trigger","hover"),t(e).mouseover(function(){var e=t("<span>",{class:"copy position-absolute right-0 pr-1 pl-1 bg-secondary text-white rounded",html:"Click to copy"});t(this).prepend(e)}),t(e).mouseout(function(){t(this).find(".copy").remove()})}}]);var u=r.DataTable({paging:!1,stateSave:!0,lengthChange:!1,autoWidth:!1,order:[[c.length-2,"desc"]],columns:c,dom:"t"});function p(){var r=new Date,s="running"!=activityMode?"/"+activityMode:"";a=t.ajax({url:"/proxy/"+agent_address+"/"+agent_port+"/activity"+s,type:"GET",beforeSend:function(e){t("#loadingIndicator").removeClass("d-none"),o=!0},async:!0,contentType:"application/json",success:function(e){t("#ErrorModal").modal("hide"),function(e){t("[data-toggle=popover]").popover("hide"),u.clear(),u.rows.add(e[activityMode].rows).draw(),t("pre code").each(function(t,e){hljs.highlightBlock(e)}),t('[data-toggle="popover"]').popover({html:!0,content:function(){return t(this).find("pre").html()},template:'<div class="popover sql" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),t("#waiting-count").html(e.waiting.rows.length||"&nbsp;").toggleClass("badge-warning",e.waiting.rows.length>0).toggleClass("badge-light",!e.waiting.rows.length>0),t("#blocking-count").html(e.blocking.rows.length||"&nbsp;").toggleClass("badge-warning",e.blocking.rows.length>0).toggleClass("badge-light",!e.blocking.rows.length>0)}(e)},error:function(e,a){if("abort"!=a){var n=e.status,o="Internal error.";n>0?o=i(JSON.parse(e.responseText).error):n="",t("#ErrorModal").modal("hide"),t("#modalError").html(function(t,e){var a="";return a+='<div class="modal" id="ErrorModal" tabindex="-1" role="dialog" aria-labelledby="ErrorModalLabel" aria-hidden="true">',a+='   <div class="modal-dialog">',a+='     <div class="modal-content">',a+='       <div class="modal-header">',a+='         <h4 class="modal-title" id="ErrorModalLabel">Error '+t+"</h4>",a+='         <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',a+="       </div>",a+='       <div class="modal-body">',a+='         <div class="alert alert-danger" role="alert">'+e+"</div>",a+="       </div>",a+='       <div class="modal-footer" id="ErrorModalFooter">',a+='         <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>',a+="       </div>",a+="     </div>",a+="   </div>",a+="</div>"}(n,o)),t("#ErrorModal").modal("show")}},complete:function(a,i){t("#loadingIndicator").addClass("d-none"),o=!1;var s=1e3*n-(new Date-r);e=window.setTimeout(p,s)}})}function b(){t("#killButton").addClass("disabled"),t("#autoRefreshPausedMsg").addClass("d-none"),t("#tableActivity input:checked").each(function(){t(this).attr("checked",!1)}),t("#tableActivity input[type=checkbox]").each(function(){t(this).attr("disabled",!0),t(this).attr("title",d)}),p()}b(),t(document.body).on("click","input[type=checkbox]",function(){t("#killButton").toggleClass("disabled",0===t("#tableActivity input:checked").length)}),t("#killButton").click(function(){if(function(t){if(!xsession)return m(),t&&t.stopPropagation(),!1;return!0}()){var e=[];if(t("#tableActivity input:checked").each(function(){e.push(t(this).data("pid"))}),0!==e.length){t("#Modal").modal("show"),t("#ModalLabel").html("Terminate backend");for(var a="",n=0;n<e.length;n++)a+='<span class="badge badge-primary">'+e[n]+"</span> ";t("#ModalInfo").html(a);'<button type="button" id="submitKill" class="btn btn-danger">Yes, terminate</button>',' <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>',t("#ModalFooter").html('<button type="button" id="submitKill" class="btn btn-danger">Yes, terminate</button> <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),t("#submitKill").click(function(){t.ajax({url:"/proxy/"+agent_address+"/"+agent_port+"/activity/kill",type:"POST",beforeSend:function(e){e.setRequestHeader("X-Session",xsession),t("#ModalInfo").html('<div class="row"><div class="col-4 offset-4"><div class="progress"><div class="progress-bar progress-bar-striped" style="width: 100%;">Please wait ...</div></div></div></div>')},async:!0,contentType:"application/json",dataType:"json",data:JSON.stringify({pids:e}),success:function(e){t("#Modal").modal("hide");var a=window.location.href;window.location.replace(a)},error:function(e){401==e.status?m():(t("#ModalInfo").html('<div class="row"><div class="col-12"><div class="alert alert-danger" role="alert">Error: '+i(JSON.parse(e.responseText).error)+"</div></div></div>"),t("#ModalFooter").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'))}})})}}});var h=t("#state-filter input[type=checkbox]");h.change(u.draw),t.fn.dataTable.ext.search.push(function(e,a,n,o){var i=[];return h.each(function(e,a){var n=t(a);n.prop("checked")&&i.push(n.val())}),i.indexOf(o.state)>-1});var g=t("#searchFilter");function m(){if(confirm("You need to be logged in the instance agent to perform this action")){var e=t.param({redirect_to:window.location.href});window.location.href=agentLoginUrl+"?"+e}}g.keyup(u.draw),t.fn.dataTable.ext.search.push(function(t,e){for(var a=g.val(),n=0,o=e.length;n<o;n++)if(-1!=e[n].toUpperCase().indexOf(a.toUpperCase()))return!0;return!1}),t("#tableActivity").on("click",".sql",function(e){e.preventDefault();var a=document.createRange(),n=window.getSelection();a.selectNodeContents(this),n.removeAllRanges(),n.addRange(a),document.execCommand("copy"),t(this).parents("td").find(".copy").html("Copied to clipboard")}),t("#tableActivity").on("mouseenter",function(n){t("#autoRefreshPausedMsg").removeClass("d-none"),a&&a.abort(),window.clearTimeout(e),t("#tableActivity input[type=checkbox]").each(function(){t(this).attr("disabled",!1),t(this).attr("title",l)})}),t("#tableActivity").on("mouseleave",function(e){0==t("#tableActivity input:checked").length&&b()}),t("#resumeAutoRefresh").on("click",function(t){b(),t.preventDefault()})});var o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function i(t){return String(t).replace(/[&<>"'\/]/g,function(t){return o[t]})}String.prototype.trunc=String.prototype.trunc||function(t){return this.length>t?this.substr(0,t-1)+"&hellip;":this},String.prototype.human2bytes=String.prototype.human2bytes||function(){var t=parseFloat(this);if("number"==typeof t){var e=this.slice(-1);return t*Math.pow(2,10*["B","K","M","G","T","P","E","Z","Y"].indexOf(e))}return this}}.call(this,a("./node_modules/jquery/dist/jquery.js"))}},[["./temboardui/plugins/activity/static/js/temboard.activity.js","runtime","vendors~activity~base~dashboard~home~monitoring~monitoring.check~monitoring.checks~notifications~set~43ba588b","vendors~activity~notifications~settings.group~settings.instance~settings.user"]]]);
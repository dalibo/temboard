(window.webpackJsonp=window.webpackJsonp||[]).push([["home"],{"./temboardui/static/js/temboard.home.js":function(e,t,n){"use strict";n.r(t),function(e){var t=n("./node_modules/lodash/lodash.js"),s=n("./node_modules/fscreen/lib/index.js"),a=n.n(s),i=(n("./temboardui/static/js/utils.js"),n("./node_modules/moment/moment.js")),o=n.n(i),r=n("./node_modules/vue/dist/vue.esm.js"),c=n("./node_modules/vue-router/dist/vue-router.esm.js");r.a.use(c.a),e(function(){r.a.component("sparkline",{props:["instance","metric","update"],mounted:i,watch:{instance:i,update:i},template:"<div></div>"}),r.a.component("checks",{props:["instance"],computed:{checks:function(){return d(this.instance)}},methods:{popoverContent:function(e){var n=e.checks.filter(function(e){return"OK"!=e.state}),s=["CRITICAL","WARNING","UNDEF"];return t.sortBy(n,function(e){return s.indexOf(e.state)}).map(function(e){return'<span class="badge badge-'+e.state.toLowerCase()+'">'+e.description+"</span>"}).join("<br>")}},template:'\n    <div\n        class="d-inline-block"\n        data-toggle="popover"\n        :data-content="popoverContent(instance)"\n        data-trigger="hover"\n        data-placement="bottom"\n        data-container="body"\n        data-html="true">\n      <span class="badge badge-critical" v-if="checks.CRITICAL">\n        CRITICAL: {{ checks.CRITICAL }}</span>\n      <span class="badge badge-warning" v-if="checks.WARNING">\n        WARNING: {{ checks.WARNING }}</span>\n      <span class="badge badge-undef" v-if="checks.UNDEF">\n        UNDEF: {{ checks.UNDEF }}</span>\n      <span class="badge badge-ok" v-if="!checks.WARNING && !checks.CRITICAL && !checks.UNDEF && checks.OK">OK</span>\n    </div>\n    '}),e.each(instances,function(e,t){t.available=null,t.checks=[],t.loading=!0}),new r.a({el:"#foo"});var n=new r.a({el:"#instances",router:new c.a,data:function(){try{var e=this.$route.query.groups.split(",")}catch(t){e=[]}return{instances:instances,search:this.$route.query.q,sort:this.$route.query.sort||"status",groups:groups,groupsFilter:e,update:o()()}},methods:{hasMonitoring:function(e){return-1!=e.plugins.map(function(e){return e.plugin_name}).indexOf("monitoring")},toggleGroupFilter:function(e,t){t.preventDefault();var n=this.groupsFilter.indexOf(e);-1!=n?this.groupsFilter.splice(n,1):this.groupsFilter.push(e)},changeSort:function(e,t){t.preventDefault(),this.sort=e},getStatusValue:s},computed:{filteredInstances:function(){var e=new RegExp(this.search,"i"),n=this.instances.filter(function(t){return e.test(t.hostname)||e.test(t.agent_address)||e.test(t.pg_data)||e.test(t.pg_port)||e.test(t.pg_version)});return("status"==this.sort?n.sort(function(e,t){return s(t)-s(e)}):t.sortBy(n,this.sort,"asc")).filter(e=>!this.groupsFilter.length||this.groupsFilter.every(t=>{return-1!=e.groups.map(e=>e.group_name).indexOf(t)}))}},mounted:u,watch:{search:function(e){this.$router.replace({query:t.assign({},this.$route.query,{q:e})})},sort:function(e){this.$router.replace({query:t.assign({},this.$route.query,{sort:e})})},groupsFilter:function(e){this.$router.replace({query:t.assign({},this.$route.query,{groups:e.join(",")})})},update:u}});function s(e){var t=d(e),n=0;return t.CRITICAL&&(n+=1e6*t.CRITICAL),t.WARNING&&(n+=1e3*t.WARNING),t.UNDEF&&(n+=t.UNDEF),n}function i(){var s=["/server",this.instance.agent_address,this.instance.agent_port,"monitoring"].join("/"),a=o()().subtract(1,"hours"),i=o()(),r={axes:{x:{drawAxis:!1,drawGrid:!1},y:{drawAxis:!1,drawGrid:!1}},dateWindow:[a,i],legend:"never",xValueParser:function(e){return o()(e).toDate().getTime()},highlightCircleSize:0,interactionModel:{}};switch(this.metric){case"load1":r=e.extend({colors:["#FAA43A"]},r);break;case"tps":r=e.extend({colors:["#50BD68","#F15854"]},r)}var c="?start="+a.toISOString()+"&end="+i.toISOString(),u=s+"/data/"+this.metric+c,l=null,d=e.get(u,function(e){l=e}),p="",h=e.when(d),g=s+"/unavailability"+c;"tps"==this.metric&&(h=e.when(d,e.get(g,function(e){p=e}))),h.then(function(){var e=l.split("\n")[0].split(",").length,s=new Array(e-1).fill("NaN");s.unshift(""),p=p.replace(/\n/g,s.join(",")+"\n");var a,i=new Dygraph(this.$el,l+p,r);"tps"==this.metric?a=i.getValue(i.numRows()-1,1)+i.getValue(i.numRows()-1,2):a=i.getValue(i.numRows()-1,1);this.instance["current"+t.capitalize(this.metric)]=a,n.$forceUpdate()}.bind(this))}l(),window.setInterval(function(){n.update=o()(),l()},6e4);function u(){e('[data-toggle="popover"]').popover("hide"),e.each(this.instances,function(t,n){n.loading=!0;var s=["/server",n.agent_address,n.agent_port,"alerting/checks.json"].join("/");e.ajax(s).done(function(t){n.checks=t,n.loading=!1,window.setTimeout(function(){e('[data-toggle="popover"]').popover(),e('[data-toggle="tooltip"]').tooltip("hide"),e('[data-toggle="tooltip"]').tooltip()},1)}.bind(this))})}function l(){instances.forEach(function(t){var n=["/server",t.agent_address,t.agent_port,"monitoring"].join("/");e.ajax(n+"/availability").done(function(e){t.available=e.available})})}function d(e){return t.countBy(e.checks.map(function(e){return e.state}))}e(".fullscreen").on("click",function(t){t.preventDefault(),e(this).addClass("d-none");const n=e(this).parents(".container-fluid")[0];a.a.requestFullscreen(n)}),a.a.onfullscreenchange=function(t){a.a.fullscreenElement||e(".fullscreen").removeClass("d-none")},e(".fullscreen").toggleClass("d-none",!a.a.fullscreenEnabled)})}.call(this,n("./node_modules/jquery/dist/jquery.js"))},"./temboardui/static/js/utils.js":function(e,t){}},[["./temboardui/static/js/temboard.home.js","runtime","vendors~activity~base~home~notifications~settings.group~settings.instance~settings.user","vendors~home"]]]);
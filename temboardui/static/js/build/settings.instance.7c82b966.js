(window.webpackJsonp=window.webpackJsonp||[]).push([["settings.instance"],{"./temboardui/static/js/temboard.settings.instance.js":function(t,e,n){"use strict";n.r(e),function(t){var e=n("./node_modules/datatables.net-bs4/js/dataTables.bootstrap4.js"),o=n.n(e);n("./node_modules/datatables.net-bs4/css/dataTables.bootstrap4.css");o()(window,t);var s='<div class="row mb-4"><div class="col-md-4 offset-md-4"><div class="progress"><div class="progress-bar progress-bar-striped" style="width: 100%;">Please wait ...</div></div></div></div>';function a(e,n,o){t("#"+e+"Label").html("Update instance properties"),t.ajax({url:"/json/settings/instance/"+n+"/"+o,type:"get",beforeSend:function(n){t("#"+e+"Info").html(s),t("#"+e+"Body").html(""),t("#"+e+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')},async:!0,contentType:"application/json",dataType:"json",success:function(s){t("#"+e+"Info").html("");var a="";a+='<form id="formUpdateInstance">',a+='  <input type="hidden" id="inputAgentAddress" value="'+s.agent_address+'" />',a+='  <input type="hidden" id="inputAgentPort" value="'+s.agent_port+'" />',a+='  <div class="row">',a+='    <div class="form-group col-sm-6">',a+='      <label for="inputNewAgentAddress" class="control-label">Agent address</label>',a+='      <input type="text" class="form-control" id="inputNewAgentAddress" placeholder="ex: db.entreprise.lan" value="'+s.agent_address+'" />',a+="    </div>",a+='    <div class="form-group col-sm-6">',a+='      <label for="inputNewAgentPort" class="control-label">Agent port</label>',a+='      <input type="text" class="form-control" id="inputNewAgentPort" placeholder="ex: 2345" value="'+s.agent_port+'" />',a+="    </div>",a+="  </div>",a+='  <div class="row">',a+='    <div class="form-group col-sm-12">',a+='      <label for="inputAgentKey" class="control-label">Agent secret key</label>',a+='      <textarea class="form-control" rows="1" id="inputAgentKey">'+s.agent_key+"</textarea>",a+="    </div>",a+="  </div>",a+='  <div class="row">',a+='    <div class="form-group col-sm-6">',a+='      <label for="selectGroups" class="control-label">Groups</label><br />',a+='      <select id="selectGroups" multiple="multiple">';var i={},c="";for(var r in s.groups)c="",s.in_groups.indexOf(r.name)>-1&&(c="selected"),a+='      <option value="'+r.name+'" '+c+">"+r.name+"</option>",i[r.name]=r.description;a+="      </select>",a+="    </div>",a+='    <div class="form-group col-sm-6">',a+='      <label for="selectPlugins" class="control-label">Active plugins</label><br />',a+='      <select id="selectPlugins" multiple="multiple">';c="";for(var d in s.loaded_plugins)c="",s.enabled_plugins.indexOf(d)>-1&&(c="selected"),a+='      <option value="'+d+'" '+c+">"+d+"</option>";a+="      </select>",a+="    </div>",a+="  </div>",a+='  <div class="row">',a+='    <div class="col-sm-12">',a+='      <div class="form-check">',a+='        <input type="checkbox" class="form-check-input" id="inputNotify" '+(s.notify?"checked":"")+">",a+='        <label for="inputNotify" class="control-label">Notify users of any status alert</label>',a+="      </div>",a+="    </div>",a+="  </div>",a+="</form>";t("#"+e+"Body").html(a),t("#"+e+"Footer").html('<i class="fa fa-spinner fa-spin loader d-none"></i><button type="submit" id="submitFormUpdateInstance" class="btn btn-success ml-auto">Save</button> <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),t("#submitFormUpdateInstance").click(function(){(t("#selectGroups").val()||confirm("No group selected.\nDo you want to proceed anyway?"))&&t("#formUpdateInstance").submit()}),t("#selectGroups").multiselect(),t("#selectPlugins").multiselect(),t(".multiselect-container li").not(".filter, .group").tooltip({placement:"right",container:"body",title:function(){var e=t(this).find("input").val();return i[e]}}),t("#formUpdateInstance").submit(function(s){s.preventDefault(),function(t,e,n,o,s,a,i){var c=["/json/settings/instance",e,n].join("/");l(t,c,o,s,a,i)}(e,n,o,t("#inputNewAgentAddress").val(),t("#inputNewAgentPort").val(),t("#inputAgentKey").val(),t("#inputNotify").prop("checked"))})},error:i.bind(null,e)})}function l(e,n,o,s,a,l){t.ajax({url:["/json/discover/instance",o,s].join("/"),type:"get",async:!0,contentType:"application/json",dataType:"json",beforeSend:c.bind(null,e),success:function(a){t.ajax({url:n,type:"post",data:JSON.stringify({new_agent_address:o,new_agent_port:s,agent_key:t("#inputAgentKey").val(),hostname:a.hostname,cpu:a.cpu,memory_size:a.memory_size,pg_data:a.pg_data,pg_port:a.pg_port,pg_version:a.pg_version,pg_version_summary:a.pg_version_summary,groups:t("#selectGroups").val(),plugins:t("#selectPlugins").val(),notify:l}),async:!0,contentType:"application/json",dataType:"json",beforeSend:c.bind(null,e),success:function(n){t("#"+e).modal("hide");var o=window.location.href;window.location.replace(o)},error:i.bind(null,e)})},error:i.bind(null,e)})}function i(e,n){var o;!function(e){t("#"+e+" .loader").addClass("d-none")}(e),t("#"+e+"Info").html('<div class="alert alert-danger" role="alert">ERROR: '+(o=JSON.parse(n.responseText).error,String(o).replace(/[&<>"'\/]/g,function(t){return u[t]}))+"</div>")}function c(e){t("#"+e+" .test-check-ok").addClass("d-none"),t("#"+e+"Info").html(""),t("#"+e+" .loader").removeClass("d-none")}function r(e,n,o){t("#"+e+"Label").html("Delete instance confirmation"),t.ajax({url:"/json/settings/instance/"+n+"/"+o,type:"get",beforeSend:function(n){t("#"+e+"Info").html(s),t("#"+e+"Body").html(""),t("#"+e+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')},async:!0,contentType:"application/json",dataType:"json",success:function(n){t("#"+e+"Info").html("");t("#"+e+"Body").html(""),t("#"+e+"Footer").html('<button type="submit" id="buttonDeleteInstance" class="btn btn-danger">Yes, delete this instance</button> <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),t("#buttonDeleteInstance").click(function(o){o.preventDefault(),function(e,n,o){t.ajax({url:"/json/settings/delete/instance",type:"post",beforeSend:function(n){c(e),t("#"+e+"Body").html("")},async:!0,contentType:"application/json",dataType:"json",data:JSON.stringify({agent_address:n,agent_port:o}),success:function(n){t("#"+e).modal("hide");var o=window.location.href;window.location.replace(o)},error:function(n){i(n,e),t("#"+e+"Body").html("")}})}(e,n.agent_address,n.agent_port)})},error:function(n){i(e,n),t("#"+e+"Body").html(""),t("#"+e+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')}})}function d(e){t("#"+e+"Label").html("Add a new instance"),t.ajax({url:"/json/settings/all/group/instance",type:"get",beforeSend:function(n){t("#"+e+"Info").html(s),t("#"+e+"Body").html(""),t("#"+e+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')},async:!0,contentType:"application/json",dataType:"json",success:function(n){t("#"+e+"Info").html("");var o="";o+='<form id="formAddInstance">',o+='  <div class="row">',o+='    <div class="form-group col-sm-6">',o+='      <label for="inputNewAgentAddress" class="control-label">Agent address</label>',o+='      <input type="text" class="form-control" id="inputNewAgentAddress" placeholder="ex: db.entreprise.lan" />',o+="    </div>",o+='    <div class="form-group col-sm-6">',o+='      <label for="inputNewAgentPort" class="control-label">Agent port</label>',o+='      <input type="text" class="form-control" id="inputNewAgentPort" placeholder="ex: 2345" />',o+="    </div>",o+="  </div>",o+='  <div class="row">',o+='    <div class="form-group col-sm-12">',o+='      <label for="inputAgentKey" class="control-label">Agent secret key</label>',o+='      <textarea class="form-control" rows="3" id="inputAgentKey"></textarea>',o+="    </div>",o+="  </div>",o+='  <div class="row">',o+='    <div class="form-group col-sm-6">',o+='      <label for="selectGroups" class="control-label">Groups</label><br />',o+='      <select id="selectGroups" multiple="multiple">';var s={};for(var a in n.groups)o+='      <option value="'+a.name+'">'+a.name+"</option>",s[a.name]=a.description;o+="      </select>",o+="    </div>",o+='    <div class="form-group col-sm-6">',o+='      <label for="selectPlugins" class="control-label">Active plugins</label><br />',o+='      <select id="selectPlugins" multiple="multiple">';for(var i in n.loaded_plugins)o+='      <option value="'+i+'" selected>'+i+"</option>";o+="      </select>",o+="    </div>",o+="  </div>",o+='  <div class="row">',o+='    <div class="col-sm-12">',o+='      <div class="form-check">',o+='        <input type="checkbox" class="form-check-input" id="inputNotify" checked>',o+='        <label for="inputNotify" class="control-label">Notify users of any status alert</label>',o+="      </div>",o+="    </div>",o+="  </div>",o+="</form>";t("#"+e+"Body").html(o),t("#"+e+"Footer").html('<i class="fa fa-spinner fa-spin loader d-none"></i><button type="submit" id="submitFormAddInstance" class="btn btn-success ml-auto">Save</button><button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),t("#submitFormAddInstance").click(function(){t("#formAddInstance").submit()}),t("#selectGroups").multiselect(),t("#selectPlugins").multiselect(),t(".multiselect-container li").not(".filter, .group").tooltip({placement:"right",container:"body",title:function(){var e=t(this).find("input").val();return s[e]}}),t("#formAddInstance").submit(function(n){n.preventDefault(),function(t,e,n,o,s){l(t,"/json/settings/instance",e,n,0,s)}(e,t("#inputNewAgentAddress").val(),t("#inputNewAgentPort").val(),t("#inputAgentKey").val(),t("#inputNotify").prop("checked"))})},error:i.bind(null,e)})}var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};t(document).ready(function(){t("#tableInstances").DataTable({stateSave:!0}),t("#buttonLoadAddInstanceForm").click(function(){t("#InstanceModal").modal("show"),t("[data-toggle=popover]").popover("hide"),d("InstanceModal")}),t(document).on("click","[data-action=edit]",function(){t("#InstanceModal").modal("show"),t("[data-toggle=popover]").popover("hide"),a("InstanceModal",t(this).data("agent_address"),t(this).data("agent_port"))}),t(document).on("click","[data-action=delete]",function(){t("#InstanceModal").modal("show"),t("[data-toggle=popover]").popover("hide"),r("InstanceModal",t(this).data("agent_address"),t(this).data("agent_port"))})})}.call(this,n("./node_modules/jquery/dist/jquery.js"))}},[["./temboardui/static/js/temboard.settings.instance.js","runtime","vendors~activity~base~notifications~settings.group~settings.instance~settings.user","vendors~activity~notifications~settings.group~settings.instance~settings.user"]]]);
(window.webpackJsonp=window.webpackJsonp||[]).push([["settings.instance"],{"./temboardui/static/js/temboard.settings.instance.js":function(t,e,n){"use strict";n.r(e);var o=n("./node_modules/datatables.net-bs4/js/dataTables.bootstrap4.js"),s=n.n(o);n("./node_modules/datatables.net-bs4/css/dataTables.bootstrap4.css");s()(window,$);var a='<div class="row mb-4"><div class="col-md-4 offset-md-4"><div class="progress"><div class="progress-bar progress-bar-striped" style="width: 100%;">Please wait ...</div></div></div></div>';function l(t,e,n){$("#"+t+"Label").html("Update instance properties"),$.ajax({url:"/json/settings/instance/"+e+"/"+n,type:"get",beforeSend:function(e){$("#"+t+"Info").html(a),$("#"+t+"Body").html(""),$("#"+t+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')},async:!0,contentType:"application/json",dataType:"json",success:function(o){$("#"+t+"Info").html("");var s="";s+='<form id="formUpdateInstance">',s+='  <input type="hidden" id="inputAgentAddress" value="'+o.agent_address+'" />',s+='  <input type="hidden" id="inputAgentPort" value="'+o.agent_port+'" />',s+='  <div class="row">',s+='    <div class="form-group col-sm-6">',s+='      <label for="inputNewAgentAddress" class="control-label">Agent address</label>',s+='      <input type="text" class="form-control" id="inputNewAgentAddress" placeholder="ex: db.entreprise.lan" value="'+o.agent_address+'" />',s+="    </div>",s+='    <div class="form-group col-sm-6">',s+='      <label for="inputNewAgentPort" class="control-label">Agent port</label>',s+='      <input type="text" class="form-control" id="inputNewAgentPort" placeholder="ex: 2345" value="'+o.agent_port+'" />',s+="    </div>",s+="  </div>",s+='  <div class="row">',s+='    <div class="form-group col-sm-12">',s+='      <label for="inputAgentKey" class="control-label">Agent secret key</label>',s+='      <textarea class="form-control" rows="1" id="inputAgentKey">'+o.agent_key+"</textarea>",s+="    </div>",s+="  </div>",s+='  <div class="row">',s+='    <div class="form-group col-sm-6">',s+='      <label for="selectGroups" class="control-label">Groups</label><br />',s+='      <select id="selectGroups" multiple="multiple">';var a={},l="";for(var c in o.groups)l="",o.in_groups.indexOf(c.name)>-1&&(l="selected"),s+='      <option value="'+c.name+'" '+l+">"+c.name+"</option>",a[c.name]=c.description;s+="      </select>",s+="    </div>",s+='    <div class="form-group col-sm-6">',s+='      <label for="selectPlugins" class="control-label">Active plugins</label><br />',s+='      <select id="selectPlugins" multiple="multiple">';l="";for(var r in o.loaded_plugins)l="",o.enabled_plugins.indexOf(r)>-1&&(l="selected"),s+='      <option value="'+r+'" '+l+">"+r+"</option>";s+="      </select>",s+="    </div>",s+="  </div>",s+='  <div class="row">',s+='    <div class="col-sm-12">',s+='      <div class="form-check">',s+='        <input type="checkbox" class="form-check-input" id="inputNotify" '+(o.notify?"checked":"")+">",s+='        <label for="inputNotify" class="control-label">Notify users of any status alert</label>',s+="      </div>",s+="    </div>",s+="  </div>",s+="</form>";$("#"+t+"Body").html(s),$("#"+t+"Footer").html('<i class="fa fa-spinner fa-spin loader d-none"></i><button type="submit" id="submitFormUpdateInstance" class="btn btn-success ml-auto">Save</button> <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),$("#submitFormUpdateInstance").click(function(){($("#selectGroups").val()||confirm("No group selected.\nDo you want to proceed anyway?"))&&$("#formUpdateInstance").submit()}),$("#selectGroups").multiselect(),$("#selectPlugins").multiselect(),$(".multiselect-container li").not(".filter, .group").tooltip({placement:"right",container:"body",title:function(){var t=$(this).find("input").val();return a[t]}}),$("#formUpdateInstance").submit(function(o){o.preventDefault(),function(t,e,n,o,s,a,l){var c=["/json/settings/instance",e,n].join("/");i(t,c,o,s,a,l)}(t,e,n,$("#inputNewAgentAddress").val(),$("#inputNewAgentPort").val(),$("#inputAgentKey").val(),$("#inputNotify").prop("checked"))})},error:c.bind(null,t)})}function i(t,e,n,o,s,a){$.ajax({url:["/json/discover/instance",n,o].join("/"),type:"get",async:!0,contentType:"application/json",dataType:"json",beforeSend:r.bind(null,t),success:function(s){$.ajax({url:e,type:"post",data:JSON.stringify({new_agent_address:n,new_agent_port:o,agent_key:$("#inputAgentKey").val(),hostname:s.hostname,cpu:s.cpu,memory_size:s.memory_size,pg_data:s.pg_data,pg_port:s.pg_port,pg_version:s.pg_version,pg_version_summary:s.pg_version_summary,groups:$("#selectGroups").val(),plugins:$("#selectPlugins").val(),notify:a}),async:!0,contentType:"application/json",dataType:"json",beforeSend:r.bind(null,t),success:function(e){$("#"+t).modal("hide");var n=window.location.href;window.location.replace(n)},error:c.bind(null,t)})},error:c.bind(null,t)})}function c(t,e){var n;!function(t){$("#"+t+" .loader").addClass("d-none")}(t),$("#"+t+"Info").html('<div class="alert alert-danger" role="alert">ERROR: '+(n=JSON.parse(e.responseText).error,String(n).replace(/[&<>"'\/]/g,function(t){return p[t]}))+"</div>")}function r(t){$("#"+t+" .test-check-ok").addClass("d-none"),$("#"+t+"Info").html(""),$("#"+t+" .loader").removeClass("d-none")}function d(t,e,n){$("#"+t+"Label").html("Delete instance confirmation"),$.ajax({url:"/json/settings/instance/"+e+"/"+n,type:"get",beforeSend:function(e){$("#"+t+"Info").html(a),$("#"+t+"Body").html(""),$("#"+t+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')},async:!0,contentType:"application/json",dataType:"json",success:function(e){$("#"+t+"Info").html("");$("#"+t+"Body").html(""),$("#"+t+"Footer").html('<button type="submit" id="buttonDeleteInstance" class="btn btn-danger">Yes, delete this instance</button> <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),$("#buttonDeleteInstance").click(function(n){n.preventDefault(),function(t,e,n){$.ajax({url:"/json/settings/delete/instance",type:"post",beforeSend:function(e){r(t),$("#"+t+"Body").html("")},async:!0,contentType:"application/json",dataType:"json",data:JSON.stringify({agent_address:e,agent_port:n}),success:function(e){$("#"+t).modal("hide");var n=window.location.href;window.location.replace(n)},error:function(e){c(e,t),$("#"+t+"Body").html("")}})}(t,e.agent_address,e.agent_port)})},error:function(e){c(t,e),$("#"+t+"Body").html(""),$("#"+t+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')}})}function u(t){$("#"+t+"Label").html("Add a new instance"),$.ajax({url:"/json/settings/all/group/instance",type:"get",beforeSend:function(e){$("#"+t+"Info").html(a),$("#"+t+"Body").html(""),$("#"+t+"Footer").html('<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>')},async:!0,contentType:"application/json",dataType:"json",success:function(e){$("#"+t+"Info").html("");var n="";n+='<form id="formAddInstance">',n+='  <div class="row">',n+='    <div class="form-group col-sm-6">',n+='      <label for="inputNewAgentAddress" class="control-label">Agent address</label>',n+='      <input type="text" class="form-control" id="inputNewAgentAddress" placeholder="ex: db.entreprise.lan" />',n+="    </div>",n+='    <div class="form-group col-sm-6">',n+='      <label for="inputNewAgentPort" class="control-label">Agent port</label>',n+='      <input type="text" class="form-control" id="inputNewAgentPort" placeholder="ex: 2345" />',n+="    </div>",n+="  </div>",n+='  <div class="row">',n+='    <div class="form-group col-sm-12">',n+='      <label for="inputAgentKey" class="control-label">Agent secret key</label>',n+='      <textarea class="form-control" rows="3" id="inputAgentKey"></textarea>',n+="    </div>",n+="  </div>",n+='  <div class="row">',n+='    <div class="form-group col-sm-6">',n+='      <label for="selectGroups" class="control-label">Groups</label><br />',n+='      <select id="selectGroups" multiple="multiple">';var o={};for(var s in e.groups)n+='      <option value="'+s.name+'">'+s.name+"</option>",o[s.name]=s.description;n+="      </select>",n+="    </div>",n+='    <div class="form-group col-sm-6">',n+='      <label for="selectPlugins" class="control-label">Active plugins</label><br />',n+='      <select id="selectPlugins" multiple="multiple">';for(var a in e.loaded_plugins)n+='      <option value="'+a+'" selected>'+a+"</option>";n+="      </select>",n+="    </div>",n+="  </div>",n+='  <div class="row">',n+='    <div class="col-sm-12">',n+='      <div class="form-check">',n+='        <input type="checkbox" class="form-check-input" id="inputNotify" checked>',n+='        <label for="inputNotify" class="control-label">Notify users of any status alert</label>',n+="      </div>",n+="    </div>",n+="  </div>",n+="</form>";$("#"+t+"Body").html(n),$("#"+t+"Footer").html('<i class="fa fa-spinner fa-spin loader d-none"></i><button type="submit" id="submitFormAddInstance" class="btn btn-success ml-auto">Save</button><button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Cancel</button>'),$("#submitFormAddInstance").click(function(){$("#formAddInstance").submit()}),$("#selectGroups").multiselect(),$("#selectPlugins").multiselect(),$(".multiselect-container li").not(".filter, .group").tooltip({placement:"right",container:"body",title:function(){var t=$(this).find("input").val();return o[t]}}),$("#formAddInstance").submit(function(e){e.preventDefault(),function(t,e,n,o,s){i(t,"/json/settings/instance",e,n,0,s)}(t,$("#inputNewAgentAddress").val(),$("#inputNewAgentPort").val(),$("#inputAgentKey").val(),$("#inputNotify").prop("checked"))})},error:c.bind(null,t)})}var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};$(document).ready(function(){$("#tableInstances").DataTable({stateSave:!0}),$("#buttonLoadAddInstanceForm").click(function(){$("#InstanceModal").modal("show"),$("[data-toggle=popover]").popover("hide"),u("InstanceModal")}),$(document).on("click","[data-action=edit]",function(){$("#InstanceModal").modal("show"),$("[data-toggle=popover]").popover("hide"),l("InstanceModal",$(this).data("agent_address"),$(this).data("agent_port"))}),$(document).on("click","[data-action=delete]",function(){$("#InstanceModal").modal("show"),$("[data-toggle=popover]").popover("hide"),d("InstanceModal",$(this).data("agent_address"),$(this).data("agent_port"))})})}},[["./temboardui/static/js/temboard.settings.instance.js","runtime","vendors~activity~notifications~settings.group~settings.instance~settings.user"]]]);